<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ - Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Readex+Pro:wght@300;400;600;700&display=swap');
        @import url('https://fonts.com/css2?family=Changa:wght@400;700&display=swap');


        :root {
            --main-font: 'Cairo', sans-serif;
        }

        body {
            font-family: var(--main-font);
        }

        .gradient-header {
            background: linear-gradient(135deg, #00A383 0%, #0093B5 100%);
        }

        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .dropdown-content.active {
            max-height: 5000px;
            transition: max-height 0.5s ease-in;
        }

        .rotate-arrow {
            transform: rotate(180deg);
            transition: transform 0.3s ease;
        }

        .header-input {
            background-color: transparent;
            border: none;
            color: white;
            padding: 0;
            margin: 0;
            width: 100%;
            text-align: right;
        }
        .header-input::placeholder {
            color: rgba(255, 255, 255, 0.8);
            opacity: 1;
        }

        summary {
            list-style: none;
            cursor: pointer;
        }
        summary::-webkit-details-marker {
            display: none;
        }
        
        #date-picker-modal .week-grid .day.selected {
            background-color: #10B981;
            color: white;
            border-color: #059669;
        }
        #date-picker-modal .week-grid .day.disabled {
            background-color: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }

        #update-modal-box {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #update-modal-box.active {
            transform: scale(1);
            opacity: 1;
        }
        
        .print-header-line {
            height: 30px;
            background: linear-gradient(135deg, #00A383 0%, #0093B5 100%);
            width: 100%;
            flex-shrink: 0;
        }
        
     
        @media print {
            .no-print { display: none !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            @page { 
                size: A4 landscape; 
                margin: 0;
            } 
            body { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
                margin: 0;
                padding: 0;
            }
            .page-container { 
                display: flex; 
                flex-direction: column; 
                min-height: 98vh;
            }
            .print-header { 
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
                margin: 0 10mm; 
                flex-shrink: 0;
                padding-top: 5mm;
            }
            .print-header .right-side { display: flex; align-items: center; gap: 8px; }
            .print-header img { height: 40px; }
            .print-header .header-text p { margin: 0; font-size: 0.9em; line-height: 1.2; }
            .print-header .title-container { text-align: center; }
            .print-header h1 { color: #00A383; margin: 0; font-size: 1.8em; }
            .print-header h2 { font-size: 1.6em; font-weight: bold; color: #0093B5; margin: 1px 0; }
            .print-header p.subtitle { color: #555; margin-top: 2px; font-size: 1.1em; }
            .print-table {
                width: calc(100% - 20mm);
                margin: 0 10mm;
                border-collapse: collapse;
                table-layout: fixed;
                font-size: 0.9em;
                page-break-inside: auto !important; /* Allow table to split if needed */
            }
            .print-table th, .print-table td {
                border: 1px solid #ccc;
                padding: 4px;
                text-align: center;
                vertical-align: middle;
            }
            .print-table th {
                background-color: #f2f2f2;
                font-weight: bold;
            }
            .print-table td.week-label {
                background-color: #e6f7ff;
                font-weight: bold;
                color: #005f99;
                text-align: center;
            }
            .print-table td.program-label {
                background-color: #f0f0f0;
                font-weight: bold;
                text-align: center;
            }
             .print-table .week-header {
                background-color: #e6f7ff;
                font-weight: bold;
                color: #005f99;
                text-align: center;
             }
            .print-signatures { 
                display: flex; 
                justify-content: space-around; 
                margin: 15px 10mm; 
                font-size: 1.1em; 
                font-weight: bold; 
                flex-shrink: 0; 
                page-break-inside: avoid;
            }
            .checkbox-cell {
                padding: 2px 4px;
            }
            .checkbox-label {
                display: flex;
                align-items: center;
                gap: 4px;
                cursor: pointer;
            }
            .checkbox-box {
                width: 12px;
                height: 12px;
                border: 1px solid #000;
                background-color: #fff;
            }
            .second-table-container {
                margin-top: 20px;
                width: calc(100% - 20mm);
                margin-left: 10mm;
                margin-right: 10mm;
            }
            .print-page {
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                position: relative;
            }
            .print-page + .print-page {
                page-break-before: always;
            }
            .print-page-content {
                flex-grow: 1;
            }
      
            .print-page-header-line {
                 height: 30px;
                 background: linear-gradient(135deg, #00A383 0%, #0093B5 100%);
                 width: 100%;
                 position: fixed;
                 top: 0;
                 left: 0;
                 z-index: 10;
            }
            /* Start of new and modified print styles */
            .print-header {
                padding-top: 2mm; /* Reduced top padding */
                margin-top: 0; /* Ensured no top margin */
                margin-bottom: 2mm; /* Reduced bottom margin */
            }
            .print-table {
                margin-top: 4mm; /* Reduced top margin for the table */
            }
            .program-entry .checkbox-group {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 2px;
                font-size: 0.8em;
                margin-top: 0; /* Removed top margin */
                padding: 0;
                line-height: 1; /* Ensured no extra line height */
            }
            .program-entry .checkbox-group label {
                display: flex;
                align-items: center;
                gap: 2px;
                white-space: nowrap;
                margin: 0; /* Removed all margins */
                padding: 0;
            }
            .print-table th, .print-table td {
                padding: 2px; /* Slightly reduced padding to save space */
            }
            .print-table td.week-label {
                width: 8%; /* Adjusted width for the first column */
            }
            .print-table .week-header {
                width: 13.14%; /* Calculated width for other columns */
            }
            /* Modified Print styles for second table */
            .print-second-table th:nth-child(2), .print-second-table td:nth-child(2) {
                width: 10%; /* Narrower width for 'Ø§Ù„Ù…Ø¬Ø§Ù„' */
            }
            .print-second-table th:nth-child(3), .print-second-table td:nth-child(3) {
                width: 25%; /* Narrower width for 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬' */
            }
            .print-second-table th:nth-child(4), .print-second-table td:nth-child(4) {
                width: 30%; /* Wider width for 'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°' */
            }
            .print-second-table td:nth-child(4) {
                white-space: nowrap; /* Prevent date from wrapping */
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="bg-red-600 text-white text-center py-2 no-print font-semibold">
        ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨ØªØ§Ø±ÙŠØ® Ù¢Ù© / Ù£ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€
    </div>

    <div id="update-modal" class="fixed inset-0 z-50 items-center justify-center p-4 no-print bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full text-center transform transition-all scale-95 opacity-0" id="update-modal-box">
            <h3 class="text-2xl font-bold mb-4 text-gray-800 flex items-center justify-center gap-2">
                <span class="text-3xl">ğŸ””</span>
                <span>ØªÙ†Ø¨ÙŠÙ‡</span>
            </h3>
            <div class="text-right space-y-3 text-gray-600">
                <p class="font-semibold text-lg">âœ¨ ÙŠØ³Ø¹Ø¯Ù†Ø§ Ø¥Ø¨Ù„Ø§ØºÙƒ Ø¨Ø£Ù†Ù†Ø§ Ø£Ø¶ÙÙ†Ø§ Ù…Ù…ÙŠØ²Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©:</p>
                <ul class="list-disc list-inside space-y-2 pr-4">
                    <li><strong class="text-teal-600">Ø§Ø®ØªÙŠØ§Ø± ØªÙØµÙŠÙ„ÙŠ:</strong> Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙ„ ÙØµÙ„ Ø¹Ù„Ù‰ Ø­Ø¯Ø© Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ù„Ù„Ù…Ø±Ø§Ø­Ù„.</li>
                    <li><strong class="text-teal-600">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:</strong> Ø£Ø¶ÙÙ†Ø§ Ù…ÙŠØ²Ø© Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙÙ‚Ø¯Ø§Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ.</li>
                </ul>
                <p class="font-semibold text-lg">âœ¨ ÙƒÙ…Ø§ ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ…ÙŠÙ…:</p>
                <ul class="list-disc list-inside space-y-2 pr-4">
                     <li><strong class="text-teal-600">ØªØºÙŠÙŠØ± Ø§Ù„ØªØ®Ø·ÙŠØ·:</strong> ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹ ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ° ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</li>
                     <li><strong class="text-teal-600">Ù…Ø±Ø§Ø­Ù„ Ø¬Ø¯ÙŠØ¯Ø©:</strong> ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ØªØ­ÙÙŠØ¸ ÙˆØ£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ ÙƒÙ…Ø±Ø§Ø­Ù„ Ø¥Ø¶Ø§ÙÙŠØ©.</li>
                </ul>
                <p class="font-bold text-center pt-4">âœ… Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¢Ù†!</p>
            </div>
            <div class="mt-6">
                <button onclick="closeUpdateModal()" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-semibold">Ù…ÙˆØ§ÙÙ‚</button>
            </div>
        </div>
    </div>

    <div id="date-picker-modal" class="fixed inset-0 z-40 items-center justify-center p-4 no-print bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Ø§Ø®ØªØ± ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</h3>
            <p id="modal-date-counter" class="text-center text-gray-600 mb-2 font-semibold"></p>
            <div id="modal-weeks-container" class="space-y-4 max-h-96 overflow-y-auto"></div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="closeDatePicker()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="saveDates()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Ø­ÙØ¸ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</button>
            </div>
        </div>
    </div>

    <div id="main-content" class="transition-opacity duration-500">
        <header class="gradient-header text-white py-4 shadow-lg no-print">
            <div class="container mx-auto px-6 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ²Ø§Ø±Ø©" class="h-16 sm:h-20">
                    <div class="flex flex-col gap-0 w-full max-w-xs sm:max-w-sm">
                        <input type="text" id="education-admin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©" class="header-input text-sm font-semibold" onblur="saveState()">
                        <input type="text" id="education-region" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©" class="header-input text-sm font-semibold" onblur="saveState()">
                        <input type="text" id="school-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="header-input text-sm font-semibold" onblur="saveState()">
                    </div>
                </div>
                <div class="text-center">
                    <h1 id="main-title" class="text-xl sm:text-3xl font-bold">Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
                    <p id="stage-title-header" class="text-lg sm:text-2xl font-bold text-white h-8"></p>
                    <p id="subtitle" class="text-md sm:text-lg opacity-90">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 1447Ù‡Ù€</p>
                </div>
            </div>
        </header>

        <section class="py-8 bg-gray-50 no-print">
            <div class="container mx-auto px-6">
                <div class="mb-8 p-6 bg-white rounded-lg shadow-md">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start text-center">
                        <div class="grid grid-cols-1 gap-6">
                             <div>
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</h3>
                                <div class="flex justify-center gap-3">
                                    <button onclick="selectRegion('other')" id="btn-other-region" class="px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg">Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</button>
                                    <button onclick="selectRegion('western')" id="btn-western-region" class="px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©</button>
                                </div>
                            </div>
                            <div class="flex flex-col items-center">
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©:</h3>
                                <select id="print-font-size" class="p-2 border rounded-md" onchange="saveState()">
                                    <option value="7px">ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹</option>
                                    <option value="8px" selected>ØµØºÙŠØ± (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
                                    <option value="10px">Ù…ØªÙˆØ³Ø·</option>
                                    <option value="12px">ÙƒØ¨ÙŠØ±</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</h3>
                            <div id="grade-selection-container" class="flex flex-col items-center gap-4">
                                </div>
                        </div>
                    </div>
                    <div class="mt-8 flex gap-4 justify-center flex-wrap">
                        <button onclick="clearAllFilters()" class="text-sm text-gray-500 hover:text-gray-700 underline">Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØµÙˆÙ„</button>
                        <button onclick="printSchedule()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                        <button onclick="saveBackup()" class="px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 transition-colors text-sm">ğŸ’¾ Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                        <button onclick="document.getElementById('backup-input').click()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm">ğŸ“‚ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø©</button>
                        <input type="file" id="backup-input" class="hidden" accept=".json" onchange="handleFileUpload(event)">
                        <button onclick="resetPlan()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©</button>
                    </div>
                </div>
            </div>
        </section>

        <main class="container mx-auto px-6 py-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø©</h2>
            </main>
            
        <div class="container mx-auto px-6 py-4 no-print">
            <div class="flex justify-between items-center gap-8">
                <input type="text" id="activity-leader-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø±Ø§Ø¦Ø¯/Ø© Ø§Ù„Ù†Ø´Ø§Ø·" class="w-1/2 p-2 text-center bg-transparent border-b-2 border-gray-300 focus:border-teal-500 outline-none" onblur="saveState()">
                <input type="text" id="school-director-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø¯ÙŠØ±/Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="w-1/2 p-2 text-center bg-transparent border-b-2 border-gray-300 focus:border-teal-500 outline-none" onblur="saveState()">
            </div>
        </div>

        <footer class="bg-gray-800 text-white py-4 text-center no-print">
            <div class="container mx-auto flex justify-center items-center">
                <a href="https://t.me/+SJnY9vPy7yo5YmI1" target="_blank" class="ml-4">
                    <img src="https://e.top4top.io/p_3463x5tj40.png" alt="Ø´Ø¹Ø§Ø± Ù‚Ù†Ø§Ø© Ø±Ø³Ù…" class="h-20 w-auto">
                </a>
                <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù‚Ù†Ø§Ø© Ø±Ø³Ù… Ù„Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© 2025</span>
            </div>
        </footer>
    </div>
    

    <script>
        const UPDATE_VERSION_KEY = 'updateModalSeen_v1';
        let selectedGrades = [];
        let currentRegion = 'other';
        let activeSelection = null;
        let tempSelectedDates = [];
        let isPrinting = false;
        let isLoading = false;

        const gradeNames = {
            'p1': 'Ø£ÙˆÙ„ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'p2': 'Ø«Ø§Ù†ÙŠ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'p3': 'Ø«Ø§Ù„Ø« Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'p4': 'Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'p5': 'Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'p6': 'Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
            'm1': 'Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·', 'm2': 'Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·', 'm3': 'Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·',
            'h1': 'Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ', 'h2': 'Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ', 'h3': 'Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ',
            'quran_lower': 'Ø£ÙˆÙ„ÙŠØ© ØªØ­ÙÙŠØ¸',
            'quran_upper': 'Ø¹Ù„ÙŠØ§ ØªØ­ÙÙŠØ¸',
        };
        
        const gradeGroups = {
            'primary_lower': ['p1', 'p2', 'p3'],
            'primary_upper': ['p4', 'p5', 'p6'],
            'quran_lower': ['quran_lower'],
            'quran_upper': ['quran_upper'],
            'primary_all': ['p1', 'p2', 'p3', 'p4', 'p5', 'p6', 'quran_lower', 'quran_upper'],
            'quran_all': ['quran_lower', 'quran_upper'],
            'middle_all': ['m1', 'm2', 'm3'],
            'high_all': ['h1', 'h2', 'h3'],
        };
        
        const teacherInputGroups = {
            'primary_lower': {
                label: 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©',
                grades: ['p1', 'p2', 'p3'],
            },
            'primary_upper': {
                label: 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§',
                grades: ['p4', 'p5', 'p6'],
            },
             'quran_lower': {
                label: 'Ø£ÙˆÙ„ÙŠØ© ØªØ­ÙÙŠØ¸',
                grades: ['quran_lower'],
            },
            'quran_upper': {
                label: 'Ø¹Ù„ÙŠØ§ ØªØ­ÙÙŠØ¸',
                grades: ['quran_upper'],
            },
            'quran_all': {
                label: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© ØªØ­ÙÙŠØ¸',
                grades: ['quran_lower', 'quran_upper'],
            },
            'middle_all': {
                label: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©',
                grades: ['m1', 'm2', 'm3'],
            },
            'high_all': {
                label: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©',
                grades: ['h1', 'h2', 'h3'],
            },
            'all': {
                label: 'ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„',
                grades: Object.keys(gradeNames),
            },
            'individual': {
                label: (grade) => gradeNames[grade],
                grades: (selectedGrades) => selectedGrades,
            }
        };

        const allGradeKeys = Object.keys(gradeNames);

        const weeksDataDefault = {
            'week1': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„', startDate: '1 / 3', endDate: '5 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '1 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '2 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '3 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '4 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '5 / 3' } },
            'week2': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', startDate: '8 / 3', endDate: '12 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 3' } },
            'week3': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«', startDate: '15 / 3', endDate: '19 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '15 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '16 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '17 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '18 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '19 / 3' } },
            'week4': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹', startDate: '22 / 3', endDate: '26 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '22 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '23 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '24 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '25 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '26 / 3' } },
            'week5': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³', startDate: '29 / 3', endDate: '3 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '29 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '30 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '1 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '2 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '3 / 4' }, specialDays: { '1 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', color: 'green' } } },
            'week6': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³', startDate: '6 / 4', endDate: '10 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '6 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '7 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '8 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '9 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '10 / 4' } },
            'week7': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹', startDate: '13 / 4', endDate: '17 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '13 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '14 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '15 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '16 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '17 / 4' } },
            'week8': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù†', startDate: '20 / 4', endDate: '24 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '20 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '21 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '22 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '23 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '24 / 4' }, specialDays: { '20 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week9': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ø³Ø¹', startDate: '27 / 4', endDate: '1 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '27 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '28 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '29 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '30 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '1 / 5' } },
            'week10': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø´Ø±', startDate: '4 / 5', endDate: '8 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '4 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '5 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '6 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '7 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '8 / 5' } },
            'week11': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±', startDate: '11 / 5', endDate: '15 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '11 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '12 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '13 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '14 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '15 / 5' } },
            'week12': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±', startDate: '18 / 5', endDate: '22 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '18 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '19 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '20 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '21 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '22 / 5' } },
            'week13': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±', startDate: '25 / 5', endDate: '29 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '25 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '26 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '27 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '28 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '29 / 5' } },
            'autumn_break': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ', startDate: '30 / 5', endDate: '8 / 6', days: {} },
            'week14': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '9 / 6', endDate: '13 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '9 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '10 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '11 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '12 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '13 / 6' } },
            'week15': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±', startDate: '16 / 6', endDate: '20 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '16 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '17 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '18 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '19 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '20 / 6' }, specialDays: { '20 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week16': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±', startDate: '23 / 6', endDate: '27 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '23 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '24 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '25 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '26 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '27 / 6' }, specialDays: { '23 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week17': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '1 / 7', endDate: '5 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '1 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '2 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '3 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '4 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '5 / 7' } },
            'week18': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù† Ø¹Ø´Ø±', startDate: '8 / 7', endDate: '12 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 7' } },
            'exams': { name: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', startDate: '15 / 7', endDate: '19 / 7', days: {} },
        };

        const weeksDataWestern = {
            'week1': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„', startDate: '8 / 3', endDate: '12 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 3' } },
            'week2': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', startDate: '15 / 3', endDate: '19 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '15 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '16 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '17 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '18 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '19 / 3' } },
            'week3': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«', startDate: '22 / 3', endDate: '26 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '22 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '23 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '24 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '25 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '26 / 3' } },
            'week4': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹', startDate: '29 / 3', endDate: '3 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '29 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '30 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '1 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '2 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '3 / 4' }, specialDays: { '1 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', color: 'green' } } },
            'week5': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³', startDate: '6 / 4', endDate: '10 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '6 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '7 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '8 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '9 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '10 / 4' } },
            'week6': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³', startDate: '13 / 4', endDate: '17 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '13 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '14 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '15 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '16 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '17 / 4' } },
            'week7': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹', startDate: '20 / 4', endDate: '24 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '20 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '21 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '22 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '23 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '24 / 4' }, specialDays: { '20 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week8': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù†', startDate: '27 / 4', endDate: '1 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '27 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '28 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '29 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '30 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '1 / 5' } },
            'week9': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ø³Ø¹', startDate: '4 / 5', endDate: '8 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '4 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '5 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '6 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '7 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '8 / 5' } },
            'week10': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø´Ø±', startDate: '11 / 5', endDate: '15 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '11 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '12 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '13 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '14 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '15 / 5' } },
            'week11': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±', startDate: '18 / 5', endDate: '22 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '18 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '19 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '20 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '21 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '22 / 5' } },
            'week12': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±', startDate: '25 / 5', endDate: '29 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '25 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '26 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '27 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '28 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '29 / 5' } },
            'autumn_break': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ', startDate: '30 / 5', endDate: '8 / 6', days: {} },
            'week13': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±', startDate: '9 / 6', endDate: '13 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '9 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '10 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '11 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '12 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '13 / 6' } },
            'week14': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '16 / 6', endDate: '20 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '16 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '17 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '18 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '19 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '20 / 6' }, specialDays: { '20 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week15': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±', startDate: '23 / 6', endDate: '27 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '23 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '24 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '25 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '26 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '27 / 6' }, specialDays: { '23 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week16': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±', startDate: '1 / 7', endDate: '5 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '1 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '2 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '3 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '4 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '5 / 7' } },
            'week17': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '8 / 7', endDate: '12 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 7' } },
            'exams': { name: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', startDate: '15 / 7', endDate: '19 / 7', days: {} },
        };

        let weeksData = weeksDataDefault;

        const activitiesData = [
            { id: 'citizenship', title: 'Ø§Ù„Ù…ÙˆØ§Ø·Ù†Ø© ÙˆØ§Ù„Ø­ÙŠØ§Ø©', color: '#981E47',icon: 'https://k.top4top.io/p_3472ccl2l0.gif', programs: [
                { name: 'Ø§Ù„ØªØ·ÙˆØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ', sessions: { p1:4, p2:4, p3:4, p4:6, p5:6, p6:6, quran_lower: 4, quran_upper: 6, m1:5, m2:5, m3:5, h1: 5, h2:5, h3:5 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø·Ù…ÙˆØ­Ø©', sessions: { p1:6, p2:6, p3:6, p4:4, p5:4, p6:4, quran_lower: 6, quran_upper: 4, m1:3, m2:3, m3:3, h1: 2, h2:2, h3:2 } },
                { name: 'Ù‚ÙŠÙ…Ù†Ø§ Ø­ÙŠØ§Ø©', sessions: { p4:12, p5:12, p6:12, quran_upper: 12, m1:12, m2:12, m3:12, h1: 12, h2:12, h3:12 } },
            ]},
            { id: 'culture', title: 'Ø§Ù„Ø«Ù‚Ø§ÙØ© ÙˆØ§Ù„ÙÙ†ÙˆÙ†', color: '#FF7145', icon: 'https://a.top4top.io/p_3472miame2.gif', programs: [
                 { name: 'Ø§Ù„ÙÙ† Ø§Ù„Ø³Ø§Ø¨Ø¹ (Ø§Ù„Ø³ÙŠÙ†Ù…Ø§)', sessions: { p1:8, p2:8, p3:8, p4:8, p5:8, p6:8, quran_lower: 8, quran_upper: 8, m1:8, m2:8, m3:8, h1: 8, h2:8, h3:8 } },
                 { name: 'Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„ÙÙ†', sessions: { p1:6, p2:6, p3:6, p4:6, p5:6, p6:6, quran_lower: 6, quran_upper: 6, m1:6, m2:6, m3:6, h1: 6, h2:6, h3:6 } },
                 { name: 'Ø§Ù„Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', sessions: { p1:4, p2:4, p3:4, p4:4, p5:4, p6:4, quran_lower: 4, quran_upper: 4, m1:6, m2:6, m3:6, h1: 6, h2:6, h3:6 } },
                 { name: 'Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠØ©', sessions: { p1:4, p2:4, p3:4, p4:4, p5:4, p6:4, quran_lower: 4, quran_upper: 4, m1:6, m2:6, m3:6, h1: 8, h2:8, h3:8 } },
                 { name: 'ØªØµØ§Ù…ÙŠÙ… ØªØ±Ø§Ø«ÙŠØ© Ù…Ø¹Ø§ØµØ±Ø©', sessions: { p1:5, p2:5, p3:5, p4:5, p5:5, p6:5, quran_lower: 5, quran_upper: 5, m1:5, m2:5, m3:5, h1: 5, h2:5, h3:5 } },
                 { name: 'Ø§Ù„ÙÙ†ÙˆÙ† Ø§Ù„Ù…Ø³Ø±Ø­ÙŠØ©', sessions: { p1:8, p2:8, p3:8, p4:8, p5:8, p6:8, quran_lower: 8, quran_upper: 8, m1:8, m2:8, m3:8, h1: 8, h2:8, h3:8 } },
                 { name: 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠ (Ø§Ù„Ø£Ù†Ø§Ø´ÙŠØ¯ Ø§Ù„ÙˆØ·Ù†ÙŠØ©)', sessions: { p1:8, p2:8, p3:8, p4:8, p5:8, p6:8, quran_lower: 8, quran_upper: 8, m1:8, m2:8, m3:8, h1: 8, h2:8, h3:8 } },
                 { name: 'Ø­ÙƒØ§ÙŠØ§Øª Ù…Ø±Ø¦ÙŠØ©', sessions: { p1:6, p2:6, p3:6, p4:6, p5:6, p6:6, quran_lower: 6, quran_upper: 6, m1:11, m2:11, m3:11, h1: 11, h2:11, h3:11 } },
            ]},
            { id: 'sports', title: 'Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ÙˆØ§Ù„ØµØ­Ø©', color: '#2FB7BD', icon: 'https://c.top4top.io/p_3472urwbn4.gif', programs: [
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©', sessions: { p1:6, p2:6, p3:6, p4:8, p5:8, p6:8, quran_lower: 6, quran_upper: 8, m1:8, m2:8, m3:8, h1: 8, h2:8, h3:8 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©', sessions: { p1:8, p2:8, p3:8, p4:8, p5:8, p6:8, quran_lower: 8, quran_upper: 8, m1:8, m2:8, m3:8, h1: 6, h2:6, h3:6 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ù†ÙØ³', sessions: { p1:8, p2:8, p3:8, p4:8, p5:8, p6:8, quran_lower: 8, quran_upper: 8, m1:8, m2:8, m3:8, h1: 6, h2:6, h3:6 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØ§Ù„ØªØ±ÙÙŠÙ‡', sessions: { p1:8, p2:8, p3:8, p4:8, p5:8, p6:8, quran_lower: 8, quran_upper: 8, m1:6, m2:6, m3:6, h1: 8, h2:8, h3:8 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø°Ù‡Ù†ÙŠØ©', sessions: { p1:6, p2:6, p3:6, p4:8, p5:8, p6:8, quran_lower: 6, quran_upper: 8, m1:8, m2:8, m3:8, h1: 8, h2:8, h3:8 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù…Ø¨ÙŠØ§Ø¯ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ', sessions: { p1:6, p2:6, p3:6, p4:8, p5:8, p6:8, quran_lower: 6, quran_upper: 8, m1:8, m2:8, m3:8, h1: 8, h2:8, h3:8 } },
            ]},
            { id: 'science', title: 'Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ©', color: '#24344D', icon: 'https://l.top4top.io/p_3472daolv1.gif', programs: [
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ·Ø¨ÙŠÙ‚Ø§Øª STEM', sessions: { p1:3, p2:3, p3:3, p4:5, p5:5, p6:5, quran_lower: 3, quran_upper: 5, m1:7, m2:7, m3:7, h1: 7, h2:7, h3:7 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØµØ§Ù…ÙŠÙ… Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©', sessions: { p1:2, p2:2, p3:2, p4:5, p5:5, p6:5, quran_lower: 2, quran_upper: 5, m1:7, m2:7, m3:7, h1: 7, h2:7, h3:7 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø±ÙˆØ§Ø¯ ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„', sessions: { p1:3, p2:3, p3:3, p4:5, p5:5, p6:5, quran_lower: 3, quran_upper: 5, m1:7, m2:7, m3:7, h1: 9, h2:9, h3:9 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø¯Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„', sessions: { p1:3, p2:3, p3:3, p4:4, p5:4, p6:4, quran_lower: 3, quran_upper: 4, m1:7, m2:7, m3:7, h1: 9, h2:9, h3:9 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', sessions: { p1:10, p2:10, p3:10, p4:10, p5:10, p6:10, quran_lower: 10, quran_upper: 10, m1:10, m2:10, m3:10, h1: 10, h2:10, h3:10 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ­Ø¯ÙŠ Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡', sessions: { p1:3, p2:3, p3:3, p4:4, p5:4, p6:4, quran_lower: 3, quran_upper: 4, m1:7, m2:7, m3:7, h1: 9, h2:9, h3:9 } },
            ]},
            { id: 'events', title: 'Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª', color: '#583C71', icon: 'https://e.top4top.io/p_34729xucx5.gif', programs: [
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¡ / Ù¤ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:4, p2:4, p3:4, p4:4, p5:4, p6:4, quran_lower: 4, quran_upper: 4, m1:4, m2:4, m3:4, h1: 4, h2:4, h3:4 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„ØªØ³Ø§Ù…Ø­ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¢Ù¥ / Ù¥ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:2, p2:2, p3:2, p4:2, p5:2, p6:2, quran_lower: 2, quran_upper: 2, m1:1, m2:1, m3:1, h1: 1, h2:1, h3:1 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„Ø·ÙÙ„', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¢Ù© / Ù¥ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:2, p2:2, p3:2, p4:2, p5:2, p6:2, quran_lower: 2, quran_upper: 2 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø©', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¡Ù¢ / Ù¦ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:2, p2:2, p3:2, p4:2, p5:2, p6:2, quran_lower: 2, quran_upper: 2, m1:2, m2:2, m3:2, h1: 2, h2:2, h3:2 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¢Ù§ / Ù¦ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:2, p2:2, p3:2, p4:2, p5:2, p6:2, quran_lower: 2, quran_upper: 2, m1:1, m2:1, m3:1, h1: 1, h2:1, h3:1 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØªØ¹Ù„ÙŠÙ…', date: 'ÙŠÙˆØ§ÙÙ‚ Ù§ / Ù¨ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:2, p2:2, p3:2, p4:2, p5:2, p6:2, quran_lower: 2, quran_upper: 2, m1:2, m2:2, m3:2, h1: 2, h2:2, h3:2 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¥ / Ù© / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:4, p2:4, p3:4, p4:4, p5:4, p6:4, quran_lower: 4, quran_upper: 4, m1:4, m2:4, m3:4, h1: 4, h2:4, h3:4 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¢Ù¢ / Ù© / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:3, p2:3, p3:3, p4:3, p5:3, p6:3, quran_lower: 3, quran_upper: 3, m1:2, m2:2, m3:2, h1: 2, h2:2, h3:2 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¨ / Ù¡Ù  / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:3, p2:3, p3:3, p4:3, p5:3, p6:3, quran_lower: 3, quran_upper: 3, m1:2, m2:2, m3:2, h1: 2, h2:2, h3:2 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ', date: 'ÙŠÙˆØ§ÙÙ‚ Ù¡Ù© / Ù¡Ù  / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { p1:2, p2:2, p3:2, p4:2, p5:2, p6:2, quran_lower: 2, quran_upper: 2, m1:2, m2:2, m3:2, h1: 2, h2:2, h3:2 } },
            ]},
            { id: 'scouting', title: 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙƒØ´ÙÙŠ', color: '#018083', icon: 'https://b.top4top.io/p_3472h0ngk3.gif', programs: [
                { name: 'Ø®ÙŠÙ…ØªÙŠ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©', sessions: { p1:3, p2:3, p3:3, quran_lower: 3 } },
                { name: 'Ø®Ø´Ø¨Ø© ÙˆØ­Ø¨Ù„', sessions: { p4:12, p5:12, p6:12, quran_upper: 12 } },
                { name: 'Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ§Ø¨Ø³', sessions: { m1:3, m2:3, m3:3 } },
                { name: 'Ø£ØºØ§Ù…Ø± ÙˆØ£ÙƒØªØ´Ù', sessions: { h1: 5, h2:5, h3:5 } },
                { name: 'Ø¨Ø±Ø§Ø¹Ù… Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹', sessions: { p1:2, p2:2, p3:2, quran_lower: 2 } },
                { name: 'Ø£Ø´Ø§Ø±Ùƒ Ù…Ø¬ØªÙ…Ø¹ÙŠ ÙˆØ£Ø²Ø±Ø¹ Ø´Ø¬Ø±Ø©', sessions: { p4:3, p5:3, p6:3, quran_upper: 3 } },
                { name: 'Ù…Ø¬ØªÙ…Ø¹ÙŠ ÙˆØ¨ÙŠØ¦ØªÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙŠ', sessions: { m1:6, m2:6, m3:6 } },
                { name: 'Ø³ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹', sessions: { h1: 5, h2:5, h3:5 } },
                { name: 'Ø¨ØµÙ…ØªÙŠ Ø§Ù„ÙƒØ´ÙÙŠØ©', sessions: { p1:3, p2:2, p3:3, quran_lower: 3 } },
                { name: 'ÙˆØ·Ù†ÙŠ ÙÙŠ Ù‚Ù„Ø¨ÙŠ', sessions: { p4:3, p5:3, p6:3, quran_upper: 3 } },
                { name: 'ØµÙ†Ø§Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±', sessions: { m1:3, m2:3, m3:3 } },
                { name: 'Ø³ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙƒØ´ÙÙŠØ©', sessions: { h1: 6, h2:6, h3:6 } },
                { name: 'Ø¨Ø±Ø§Ø¹Ù… Ø§Ù„Ù†ÙˆØ±', sessions: { p1:2, p2:2, p3:2, quran_lower: 2 } },
                { name: 'ÙƒÙ†ÙˆØ² Ø§Ù„ØµØºØ§Ø±', sessions: { p4:2, p5:2, p6:2, quran_upper: 2 } },
                { name: 'Ù…Ù† Ù‡Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø³Ù†Ø©', sessions: { m1:3, m2:3, m3:3 } },
                { name: 'Ø¯Ø±Ø¨ Ø§Ù„Ø¥Ø­Ø³Ø§Ù†', sessions: { h1: 3, h2:3, h3:3 } },
                { name: 'Ø¨ÙˆØµÙ„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù', sessions: { p1:3, p2:3, p3:3, quran_lower: 3 } },
                { name: 'Ø®ÙŠÙ…Ø© Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ù…Ø³Ù„ÙŠØ©', sessions: { p4:6, p5:6, p6:6, quran_upper: 6 } },
                { name: 'Ù…Ø®ÙŠÙ…ÙŠ Ø§Ù„ØªÙ‚Ù†ÙŠ', sessions: { m1:10, m2:10, m3:10 } },
                { name: 'ÙˆØ§Ø­Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙƒØ´ÙÙŠ', sessions: { h1: 4, h2:4, h3:4 } },
                { name: 'Ø¹Ø§Ø¯Ø§ØªÙŠ Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„ÙƒØ´ÙÙŠØ©', sessions: { p1:3, p2:3, p3:3, quran_lower: 3 } },
                { name: 'Ø·Ø¨Ù‚ÙŠ Ø§Ù„ÙƒØ´ÙÙŠ', sessions: { p4:3, p5:3, p6:3, quran_upper: 3 } },
                { name: 'Ø®Ø·ÙˆØ§ØªÙŠ Ø§Ù„ÙƒØ´ÙÙŠØ© Ø§Ù„ØµØ­ÙŠØ©', sessions: { m1:3, m2:3, m3:3 } },
                { name: 'Ù…Ù‡Ø±Ø¬Ø§Ù† Ø§Ù„Ø£ÙÙ„Ø§Ù… Ø§Ù„ÙƒØ´ÙÙŠØ© Ø§Ù„ØµØ­ÙŠØ©', sessions: { h1: 5, h2:5, h3:5 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§ØªÙŠ ÙˆÙƒØ´ÙÙŠØªÙŠ', sessions: { p1:2, p2:2, p3:2, quran_lower: 2 } },
                { name: 'ØµØ§ÙØ±Ø© ÙˆØ§ØµØ·ÙØ§Ù', sessions: { p4:2, p5:2, p6:2, quran_upper: 2 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§ØªÙŠ Ø§Ù„ÙƒØ´ÙÙŠØ© Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', sessions: { m1:4, m2:4, m3:4 } },
                { name: 'Ø£ÙÙ‚ÙŠ Ø§Ù„ÙƒØ´ÙÙŠ Ø§Ù„ÙˆØ§Ø³Ø¹', sessions: { h1: 6, h2:6, h3:6 } },
            ]},
        ];
        
        function parseDateForSort(dateStr) {
            const parts = dateStr.split(' ');
            const datePart = parts.slice(1).join('');
            const dateParts = datePart.split('/');
            if (dateParts.length < 2) return 9999;
            const day = parseInt(dateParts[0], 10);
            const month = parseInt(dateParts[1], 10);
            return month * 100 + day;
        }

        function formatDatesForDisplay(datesArray) {
            if (!datesArray || datesArray.length === 0) {
                return { text: '', json: '[]' };
            }

            // Sort dates chronologically to find the first and last
            const sortedDates = [...datesArray].sort((a, b) => parseDateForSort(a) - parseDateForSort(b));
            
            const firstDateStr = sortedDates[0];
            const lastDateStr = sortedDates[sortedDates.length - 1];
            
            const getWeekInfoForDate = (fullDateStr) => {
                const datePartWithSpaces = fullDateStr.split(' ').slice(1).join(' '); 
                for (const weekKey in weeksData) {
                    const week = weeksData[weekKey];
                    if (Object.values(week.days).includes(datePartWithSpaces)) {
                        return week;
                    }
                }
                return null;
            };

            const firstWeekInfo = getWeekInfoForDate(firstDateStr);
            const lastWeekInfo = getWeekInfoForDate(lastDateStr);

            let textContent = '';

            // This is the updated logic
            if (firstWeekInfo && lastWeekInfo) {
                if (sortedDates.length === 1) {
                    // For a single date, just show the full date string
                    textContent = firstDateStr;
                } else {
                    // Always show the range for more than one date
                    textContent = `Ù…Ù† ${firstWeekInfo.name} (${firstDateStr}) Ø¥Ù„Ù‰ ${lastWeekInfo.name} (${lastDateStr})`;
                }
            } else {
                // Fallback for dates not found in the week data
                textContent = sortedDates.join(' | ');
            }

            return {
                text: textContent,
                json: JSON.stringify(sortedDates)
            };
        }

        function createGradeSelectionUI() {
            const container = document.getElementById('grade-selection-container');
            container.innerHTML = `
                <button onclick="handleGradeSelection('all')" id="btn-all" class="w-full max-w-sm flex items-center justify-center gap-2 px-4 py-2 rounded-full font-medium transition-all duration-300">ğŸ« Ø§Ù„ÙƒÙ„</button>
            `;

            const stages = [
                { title: 'Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©', groups: [
                    { label: 'Ø§Ù„ÙƒÙ„', key: 'primary_all' }, 
                    { label: 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©', key: 'primary_lower' },
                    { label: 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§', key: 'primary_upper' },
                    { label: 'ØªØ­ÙÙŠØ¸', key: 'quran_all' },
                    
                ], individuals: ['p1', 'p2', 'p3', 'p4', 'p5', 'p6', 'quran_lower', 'quran_upper'] },
                { title: 'Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©', groups: [{ label: 'Ø§Ù„ÙƒÙ„', key: 'middle_all' }], individuals: ['m1', 'm2', 'm3'] },
                { title: 'Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©', groups: [{ label: 'Ø§Ù„ÙƒÙ„', key: 'high_all' }], individuals: ['h1', 'h2', 'h3'] }
            ];

            stages.forEach(stage => {
                const stageWrapper = document.createElement('div');
                stageWrapper.className = 'w-full max-w-sm border p-2 rounded-lg';
                
                const titleEl = document.createElement('h4');
                titleEl.className = 'font-semibold mb-2';
                titleEl.textContent = stage.title;
                stageWrapper.appendChild(titleEl);

                const groupsContainer = document.createElement('div');
                groupsContainer.className = 'flex flex-wrap justify-center gap-2 mb-2';
                stage.groups.forEach(group => {
                    groupsContainer.innerHTML += `<button onclick="handleGradeSelection('${group.key}')" id="btn-${group.key}" class="px-3 py-1 rounded-full text-sm font-medium transition-all duration-300">${group.label}</button>`;
                });
                stageWrapper.appendChild(groupsContainer);

                const individualsContainer = document.createElement('div');
                individualsContainer.className = 'flex flex-wrap justify-center gap-2 border-t pt-2 mt-2';
                 stage.individuals.forEach(indKey => {
                    individualsContainer.innerHTML += `<button onclick="handleGradeSelection('${indKey}')" id="btn-${indKey}" class="px-3 py-1 rounded-full text-sm font-medium transition-all duration-300">${gradeNames[indKey]}</button>`;
                });
                stageWrapper.appendChild(individualsContainer);

                container.appendChild(stageWrapper);
            });
        }
        
        // Global utility function to get the correct label for a grade key
        const getLabel = (key) => {
            if (key === 'primary_all') return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©';
            if (key === 'primary_lower') return 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©';
            if (key === 'primary_upper') return 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§';
            if (key === 'middle_all') return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©';
            if (key === 'high_all') return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©';
            if (key === 'quran_lower') return 'Ø£ÙˆÙ„ÙŠØ© ØªØ­ÙÙŠØ¸';
            if (key === 'quran_upper') return 'Ø¹Ù„ÙŠØ§ ØªØ­ÙÙŠØ¸';
            return gradeNames[key];
        };

        // This function is now updated to get the original session count
        function getProgramSessionsText(programSelection, programId) {
            if (!programSelection || !programSelection.datesByGrade) {
                return '';
            }
            
            const programData = activitiesData.flatMap(f => f.programs).find((p, i) => `${f.id}-${i}` === programId);
            if (!programData) {
                return '';
            }
            
            const gradeLabels = [];
            const allSelectedKeys = Object.keys(programSelection.datesByGrade);
            
            // This function needs to return the original session count for a given grade key
            const getOriginalSessions = (gradeKey) => {
                return programData.sessions[gradeKey] || 0;
            };

            const handledKeys = new Set();
            const groupsOrder = ['primary_all', 'quran_all', 'middle_all', 'high_all', 'primary_lower', 'primary_upper', 'quran_lower', 'quran_upper'];
            
            groupsOrder.forEach(groupKey => {
                // Check if the group itself was selected, or if all its members were selected individually
                const isGroupExplicitlySelected = selectedGrades.includes(groupKey);
                const isGroupImplicitlySelected = (gradeGroups[groupKey] || []).length > 0 && (gradeGroups[groupKey] || []).every(g => selectedGrades.includes(g));

                if ((isGroupExplicitlySelected || isGroupImplicitlySelected) && !handledKeys.has(groupKey)) {
                    let maxSessionsInGroup = 0;
                    if(groupKey === 'all') { // Handle 'all' separately if needed
                       maxSessionsInGroup = Math.max(...(Object.keys(programData.sessions).map(k => programData.sessions[k])));
                    } else {
                        const gradesInGroup = gradeGroups[groupKey] || [groupKey];
                        maxSessionsInGroup = Math.max(...gradesInGroup.map(g => getOriginalSessions(g)));
                    }

                    if (maxSessionsInGroup > 0) {
                        gradeLabels.push(`${getLabel(groupKey)}: ${maxSessionsInGroup} Ø­ØµØ©`);
                        (gradeGroups[groupKey] || [groupKey]).forEach(g => handledKeys.add(g));
                    }
                }
            });

            // Fallback for individual grades if their groups weren't selected
            allSelectedKeys.forEach(key => {
                if (!handledKeys.has(key)) {
                    const sessionCount = getOriginalSessions(key);
                    if (sessionCount > 0) {
                        gradeLabels.push(`${getLabel(key)}: ${sessionCount} Ø­ØµØ©`);
                    }
                }
            });
            
            return gradeLabels.join('ØŒ ');
        }
        
        function populateProgramsTable() {
            // This function is no longer needed to render the table in the main view
            // as it will be generated only on print.
        }
        
        function updateSecondTableDates() {
            // This function is no longer needed
        }

        function generateSections() {
            const mainContainer = document.querySelector('main');
            mainContainer.innerHTML = ''; 

            activitiesData.forEach(section => {
                const programRows = section.programs.map((prog, index) => {
                    const uniqueId = `${section.id}-${index}`;
                    return `
                    <tr 
                        data-program-id="${uniqueId}" 
                        data-program-name="${prog.name}" 
                        data-field-name="${section.title}" 
                        data-field-color="${section.color}"
                        data-sessions='${JSON.stringify(prog.sessions)}'
                    >
                        <td class="border border-gray-300 px-2 py-3 font-semibold" style="background-color: ${section.color}; color: white;">${section.title}</td>
                        <td class="border border-gray-300 px-2 py-3">
                            <div>${prog.name}</div>
                            ${prog.date ? `<div class="text-sm text-blue-600 font-semibold pt-1">${prog.date}</div>` : ''}
                        </td>
                        <td class="border border-gray-300 px-2 py-3 align-top">
                            <div class="teacher-inputs-container space-y-2" data-program-id="${uniqueId}"></div>
                        </td>
                        <td class="border border-gray-300 px-2 py-3 align-top">
                            <div class="space-y-1" id="selectors-container-${uniqueId}"></div>
                        </td>
                    </tr>
                `}).join('');

                const sectionHTML = `
                    <section id="${section.id}" class="mb-8">
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                            <button onclick="toggleDropdown('${section.id}-dropdown')" class="w-full px-6 py-4 text-right font-bold text-lg flex justify-between items-center transition-colors hover:bg-gray-50" style="background-color: ${section.color}; color: white;">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center ml-4 overflow-hidden">
                                        <img src="${section.icon}" alt="${section.title}" class="w-8 h-8 object-contain">
                                    </div>
                                    <span>${section.title}</span>
                                </div>
                                <svg id="${section.id}-arrow" class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="${section.id}-dropdown" class="dropdown-content">
                                <div class="p-6">
                                    <div class="overflow-x-auto">
                                        <table class="w-full border-collapse border border-gray-300">
                                            <thead>
                                                <tr class="bg-gray-100">
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-[10%]">Ø§Ù„Ù…Ø¬Ø§Ù„</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-[40%]">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-[40%]">Ø§Ù„Ù…Ø¹Ù„Ù…/Ø© Ø§Ù„Ù…Ù†ÙØ°/Ø©</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-center font-semibold w-[10%]">ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</th>
                                                </tr>
                                            </thead>
                                            <tbody>${programRows}</tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                `;
                mainContainer.innerHTML += sectionHTML;
            });
        }
        
        function updateAllDateSelectors() {
            document.querySelectorAll('tr[data-program-id]').forEach(row => {
                updateDateSelectorsForRow(row);
                updateTeacherInputsForRow(row);
            });
            // updateSecondTableDates(); // Removed this call as the function is no longer needed
        }
        
        function updateTeacherInputsForRow(row) {
            const uniqueId = row.dataset.programId;
            const container = row.querySelector(`.teacher-inputs-container`);
            if (!container) return;

            const sessions = JSON.parse(row.dataset.sessions);
            const effectiveGrades = getEffectiveIndividualGrades().filter(grade => sessions[grade] > 0);

            let newHTML = '';
            
            let teacherGroupsToDisplay = [];
            const isAllSelected = selectedGrades.includes('all');
            
            if (isAllSelected) {
                teacherGroupsToDisplay.push('all');
            } else {
                 teacherGroupsToDisplay.push(...selectedGrades);
            }

            teacherGroupsToDisplay = teacherGroupsToDisplay.filter(key => {
                const groupGrades = gradeGroups[key] || [key];
                return groupGrades.some(g => effectiveGrades.includes(g));
            });

            if (teacherGroupsToDisplay.length === 0 && effectiveGrades.length > 0) {
                 teacherGroupsToDisplay = effectiveGrades;
            }

            teacherGroupsToDisplay.forEach(key => {
                const groupData = teacherInputGroups[key];
                const label = (groupData ? groupData.label : gradeNames[key]) || 'Ù…Ø±Ø­Ù„Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©';
                newHTML += `
                    <div class="teacher-input-group">
                        <label class="text-xs text-gray-500 font-semibold">${label}</label>
                        <textarea placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø©" class="teacher-input w-full p-1 border rounded text-sm" data-grade-key="${key}" rows="2" onblur="saveState()"></textarea>
                    </div>
                `;
            });

            container.innerHTML = newHTML;
        }

        function updateDateSelectorsForRow(row) {
            const uniqueId = row.dataset.programId;
            const sessions = JSON.parse(row.dataset.sessions);
            const container = document.getElementById(`selectors-container-${uniqueId}`);
            if (!container) return;
            container.innerHTML = '';

            const itemsToDisplay = selectedGrades.includes('all') 
                ? ['primary_lower', 'primary_upper', 'quran_lower', 'quran_upper', 'middle_all', 'high_all'] 
                : selectedGrades;

            let newHTML = '';
            itemsToDisplay.forEach(key => {
                const individualGradeKeys = gradeGroups[key] || [key];
                let sessionCount = 0;
                let label = getLabel(key); 
                
                sessionCount = Math.max(0, ...individualGradeKeys.map(g => sessions[g] || 0));

                if (sessionCount > 0) {
                    newHTML += `
                    <div class="grade-date-selector p-2 border-t first:border-t-0" data-grade-key="${key}">
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="font-semibold">${label}</span>
                            <span class="text-gray-500">${sessionCount} Ø­ØµØµ</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <div class="dates-display text-xs text-gray-600 flex-grow text-right p-1 bg-gray-50 rounded min-h-[26px]" data-dates="[]"></div>
                            <div class="flex-shrink-0 flex gap-1">
                                <button class="date-select-btn bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" onclick="openDatePicker('${uniqueId}', '${key}')">Ø§Ø®ØªÙŠØ§Ø±</button>
                                <button class="clear-date-btn bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600" onclick="clearGradeDates('${uniqueId}', '${key}')">Ù…Ø³Ø­</button>
                            </div>
                        </div>
                    </div>`;
                }
            });

            container.innerHTML = newHTML;
        }

        function getEffectiveIndividualGrades() {
            if (selectedGrades.includes('all')) {
                return [...allGradeKeys];
            }
            let individuals = [];
            selectedGrades.forEach(item => {
                individuals.push(...(gradeGroups[item] || [item]));
            });
            return [...new Set(individuals)];
        }

        function handleGradeSelection(key) {
            if (key === 'all') {
                selectedGrades = ['all'];
            } else {
                let newSelection = selectedGrades.includes('all') ? [] : [...selectedGrades];
                
                const isAdding = !newSelection.includes(key);

                if (isAdding) {
                    if (key === 'quran_all') {
                        newSelection = newSelection.filter(item => !gradeGroups['quran_all'].includes(item));
                        newSelection.push('quran_lower', 'quran_upper');
                    } else if (key === 'primary_all') {
                        newSelection = newSelection.filter(item => !gradeGroups['primary_all'].includes(item));
                        newSelection.push('primary_lower', 'primary_upper', 'quran_lower', 'quran_upper');
                    } else if (key === 'primary_lower') {
                        newSelection = newSelection.filter(item => !gradeGroups['primary_lower'].includes(item) && item !== 'primary_all');
                        newSelection.push(key);
                    } else if (key === 'primary_upper') {
                         newSelection = newSelection.filter(item => !gradeGroups['primary_upper'].includes(item) && item !== 'primary_all');
                         newSelection.push(key);
                    } else if (key === 'middle_all') {
                        newSelection = newSelection.filter(item => !gradeGroups['middle_all'].includes(item) && item !== 'middle_all');
                        newSelection.push(key);
                    } else if (key === 'high_all') {
                        newSelection = newSelection.filter(item => !gradeGroups['high_all'].includes(item) && item !== 'high_all');
                        newSelection.push(key);
                    } else {
                        let conflicts = [];
                        for (const groupKey in gradeGroups) {
                             if (groupKey !== 'quran_all' && groupKey !== 'primary_all' && gradeGroups[groupKey].includes(key)) {
                                conflicts.push(groupKey);
                            }
                        }
                        newSelection = newSelection.filter(item => !conflicts.includes(item));
                        newSelection.push(key);
                    }
                } else {
                    if (key === 'all') {
                        newSelection = [];
                    } else if (key === 'quran_all') {
                        newSelection = newSelection.filter(item => !gradeGroups['quran_all'].includes(item));
                    } else if (key === 'primary_all') {
                        newSelection = newSelection.filter(item => !gradeGroups['primary_all'].includes(item));
                    } else {
                         newSelection = newSelection.filter(item => item !== key);
                         const groupOfKey = Object.keys(gradeGroups).find(group => gradeGroups[group].includes(key));
                         if (groupOfKey) {
                            const isGroupDeselected = gradeGroups[groupOfKey].every(g => !newSelection.includes(g));
                            if (isGroupDeselected) {
                                newSelection = newSelection.filter(item => item !== groupOfKey);
                            }
                         }
                    }
                }
                
                selectedGrades = newSelection;
            }

            updateButtonStyles();
            updateTitle();
            updateAllDateSelectors();
            saveState();
        }


        function updateButtonStyles() {
            const effectiveSelection = getEffectiveIndividualGrades();
            
            allGradeKeys.forEach(key => {
                const btn = document.getElementById(`btn-${key}`);
                if(btn) {
                    if (effectiveSelection.includes(key)) {
                        btn.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                        btn.classList.remove('bg-gray-200', 'text-gray-700');
                    } else {
                        btn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    }
                }
            });

            Object.keys(gradeGroups).forEach(key => {
                const btn = document.getElementById(`btn-${key}`);
                if(btn) {
                    const groupMembers = gradeGroups[key];
                    if (groupMembers.length > 0) {
                        const isGroupSelected = groupMembers.every(g => effectiveSelection.includes(g));
                        if (isGroupSelected) {
                            btn.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                            btn.classList.remove('bg-gray-200', 'text-gray-700');
                        } else {
                            btn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                            btn.classList.add('bg-gray-200', 'text-gray-700');
                        }
                    }
                }
            });

            const btnAll = document.getElementById('btn-all');
            if (selectedGrades.includes('all')) {
                btnAll.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                btnAll.classList.remove('bg-gray-200', 'text-gray-700');
            } else {
                btnAll.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                btnAll.classList.add('bg-gray-200', 'text-gray-700');
            }
        }


        function selectRegion(region) {
            currentRegion = region;
            weeksData = region === 'western' ? weeksDataWestern : weeksDataDefault;

            const btnWestern = document.getElementById('btn-western-region');
            const btnOther = document.getElementById('btn-other-region');

            if (region === 'western') {
                btnWestern.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg';
                btnOther.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700';
            } else {
                btnOther.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg';
                btnWestern.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200', 'text-gray-700';
            }
            saveState();
        }

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const arrow = document.getElementById(dropdownId.replace('-dropdown', '-arrow'));
            
            document.querySelectorAll('.dropdown-content.active').forEach(openDropdown => {
                if (openDropdown.id !== dropdownId) {
                    openDropdown.classList.remove('active');
                    const otherArrow = document.getElementById(openDropdown.id.replace('-dropdown', '-arrow'));
                    if (otherArrow) otherArrow.classList.remove('rotate-arrow');
                }
            });

            dropdown.classList.toggle('active');
            arrow.classList.toggle('rotate-arrow');
        }

        function updateTitle() {
            const stageTitleHeader = document.getElementById('stage-title-header');
            const selectedGradeKeys = selectedGrades.filter(g => g !== 'all');
            let titleText = '';

            if (selectedGrades.includes('all')) {
                titleText = 'Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©';
            } else if (selectedGradeKeys.length > 0) {
                const parts = [];
                const primaryGrades = ['p1', 'p2', 'p3', 'p4', 'p5', 'p6'];
                const hasLowerPrimary = selectedGradeKeys.includes('primary_lower');
                const hasUpperPrimary = selectedGradeKeys.includes('primary_upper');
                const hasQuranLower = selectedGradeKeys.includes('quran_lower');
                const hasQuranUpper = selectedGradeKeys.includes('quran_upper');
                
                if (hasLowerPrimary && hasUpperPrimary) {
                    parts.push('Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©');
                } else if (hasLowerPrimary) {
                    parts.push('Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©');
                } else if (hasUpperPrimary) {
                    parts.push('Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§');
                }

                if (hasQuranLower && hasQuranUpper) {
                     parts.push('Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© ØªØ­ÙÙŠØ¸');
                } else {
                    const quranIndividuals = selectedGradeKeys.filter(g => g.startsWith('quran'));
                    if (quranIndividuals.length > 0) {
                        parts.push(...quranIndividuals.map(g => gradeNames[g]));
                    }
                }

                if (selectedGradeKeys.includes('middle_all')) {
                    parts.push('Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©');
                } else {
                    const middleIndividuals = selectedGradeKeys.filter(g => g.startsWith('m'));
                    if (middleIndividuals.length > 0) {
                        parts.push(...middleIndividuals.map(g => gradeNames[g]));
                    }
                }

                if (selectedGradeKeys.includes('high_all')) {
                    parts.push('Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©');
                } else {
                    const highIndividuals = selectedGradeKeys.filter(g => g.startsWith('h'));
                    if (highIndividuals.length > 0) {
                        parts.push(...highIndividuals.map(g => gradeNames[g]));
                    }
                }
                
                const individualPrimary = selectedGradeKeys.filter(g => primaryGrades.includes(g) && !hasLowerPrimary && !hasUpperPrimary);
                if (individualPrimary.length > 0) {
                     parts.push(...individualPrimary.map(g => gradeNames[g]));
                }
                
                titleText = 'Ù„Ù€ ' + [...new Set(parts)].join(' Ùˆ ');
            }
            
            stageTitleHeader.textContent = titleText;
        }
        
        function clearAllFilters() {
            selectedGrades = [];
            updateButtonStyles();
            updateTitle();
            updateAllDateSelectors();
            saveState();
        }

        function clearGradeDates(programId, key) {
            const row = document.querySelector(`tr[data-program-id="${programId}"]`);
            if (row) {
                const display = row.querySelector(`.grade-date-selector[data-grade-key="${key}"] .dates-display`);
                if (display) {
                    display.textContent = '';
                    display.dataset.dates = '[]';
                }
                saveState();
            }
        }

        function openDatePicker(programId, key) {
            activeSelection = { programId, key };
            const row = document.querySelector(`tr[data-program-id="${programId}"]`);
            const programName = row.dataset.programName;
            const sessions = JSON.parse(row.dataset.sessions);
            
            const individualGradeKeys = gradeGroups[key] || [key];
            
            let totalRequiredSessions = 0;
            let label = getLabel(key);
            
            totalRequiredSessions = Math.max(0, ...individualGradeKeys.map(g => sessions[g] || 0));
            
            document.getElementById('modal-title').textContent = `${programName} - ${label}`;
            
            const displayDiv = row.querySelector(`.grade-date-selector[data-grade-key="${key}"] .dates-display`);
            tempSelectedDates = displayDiv.dataset.dates ? JSON.parse(displayDiv.dataset.dates) : [];

            updateDatePickerCounter(totalRequiredSessions);

            const container = document.getElementById('modal-weeks-container');
            container.innerHTML = '';

            Object.entries(weeksData).forEach(([weekKey, weekData]) => {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'p-2 border rounded-md';
                weekDiv.innerHTML = `<p class="font-semibold text-center mb-2">${weekData.name} (${weekData.startDate} - ${weekData.endDate})</p>`;
                
                const weekGrid = document.createElement('div');
                weekGrid.className = 'week-grid grid grid-cols-5 gap-2';
                
                Object.entries(weekData.days).forEach(([dayName, dayDate]) => {
                    const dayButton = document.createElement('button');
                    const fullDate = `${dayName} ${dayDate}`;
                    dayButton.className = 'day p-2 border rounded-md text-sm';
                    dayButton.dataset.date = fullDate;
                    
                    let buttonText = `${dayName}<br>${dayDate}`;
                    if (weekData.specialDays && weekData.specialDays[dayDate]) {
                        dayButton.classList.add('disabled');
                        dayButton.disabled = true;
                        buttonText += `<br><span class="text-xs">${weekData.specialDays[dayDate].name}</span>`;
                    } else {
                        dayButton.onclick = () => toggleDateSelection(dayButton, totalRequiredSessions);
                    }
                    
                    if (tempSelectedDates.includes(fullDate)) {
                        dayButton.classList.add('selected');
                    }
                    
                    dayButton.innerHTML = buttonText;
                    weekGrid.appendChild(dayButton);
                });
                weekDiv.appendChild(weekGrid);
                container.appendChild(weekDiv);
            });

            document.getElementById('date-picker-modal').style.display = 'flex';
        }

        function toggleDateSelection(button, totalMaxDates) {
            const date = button.dataset.date;
            const isSelected = tempSelectedDates.includes(date);

            if (isSelected) {
                tempSelectedDates = tempSelectedDates.filter(d => d !== date);
                button.classList.remove('selected');
            } else {
                if (tempSelectedDates.length >= totalMaxDates) {
                    alert(`Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ (${totalMaxDates} ØªÙˆØ§Ø±ÙŠØ®).`);
                    return;
                }
                tempSelectedDates.push(date);
                button.classList.add('selected');
            }
            updateDatePickerCounter(totalMaxDates);
        }
        
        function updateDatePickerCounter(maxSessions) {
            const counterElement = document.getElementById('modal-date-counter');
            if (counterElement) {
                counterElement.textContent = `Ø§Ø®ØªØ± ${tempSelectedDates.length} Ù…Ù† ${maxSessions} ØªØ§Ø±ÙŠØ®`;
            }
        }

        function closeDatePicker() {
            document.getElementById('date-picker-modal').style.display = 'none';
            activeSelection = null;
            tempSelectedDates = [];
        }

        function saveDates() {
            if (!activeSelection) return;
            const { programId, key } = activeSelection;
            const row = document.querySelector(`tr[data-program-id="${programId}"]`);
            const datesDisplay = row.querySelector(`.grade-date-selector[data-grade-key="${key}"] .dates-display`);
            if (datesDisplay) {
                const formatted = formatDatesForDisplay(tempSelectedDates);
                datesDisplay.textContent = formatted.text;
                datesDisplay.dataset.dates = formatted.json;
            }
            saveState();
            closeDatePicker();
        }
        
        function printSchedule() {
            if (isPrinting) {
                alert('Ø¹Ù…Ù„ÙŠØ© Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.');
                return;
            }
            isPrinting = true;
        
            try {
                const state = JSON.parse(localStorage.getItem('activityPlanState')) || {};
                if (!state) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.');
                    isPrinting = false;
                    return;
                }
                
                const currentWeeksData = state.currentRegion === 'western' ? weeksDataWestern : weeksDataDefault;

                const programSelections = state.programSelections || {};
                const effectiveGradesForPrint = getEffectiveIndividualGrades();
                
                if (effectiveGradesForPrint.length === 0) {
                     alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.');
                     isPrinting = false;
                     return;
                }
                
                const programsByWeekAndField = {};
                
                const getWeekInfoForDate = (fullDateStr) => {
                    const datePartWithSpaces = fullDateStr.split(' ').slice(1).join(' '); 
                    for (const weekKey in currentWeeksData) {
                        const week = currentWeeksData[weekKey];
                        if (Object.values(week.days).includes(datePartWithSpaces)) {
                            return week;
                        }
                    }
                    return null;
                };

                const getGradeLabelForPrint = (gradeKey) => {
                    const selectedGradeKeys = state.selectedGrades.filter(g => g !== 'all');

                    if (state.selectedGrades.includes('all')) {
                        if (gradeGroups['primary_lower'].includes(gradeKey) || gradeGroups['primary_upper'].includes(gradeKey) || gradeGroups['quran_lower'].includes(gradeKey) || gradeGroups['quran_upper'].includes(gradeKey)) {
                            const isQuran = gradeGroups['quran_lower'].includes(gradeKey) || gradeGroups['quran_upper'].includes(gradeKey);
                            return isQuran ? 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© ØªØ­ÙÙŠØ¸' : 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©';
                        }
                        if (gradeGroups['middle_all'].includes(gradeKey)) return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©';
                        if (gradeGroups['high_all'].includes(gradeKey)) return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©';
                    }

                    if (selectedGradeKeys.includes('primary_all')) return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©';
                    if (selectedGradeKeys.includes('quran_all')) return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© ØªØ­ÙÙŠØ¸';
                    if (selectedGradeKeys.includes('middle_all')) return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©';
                    if (selectedGradeKeys.includes('high_all')) return 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©';
                    
                    if (selectedGradeKeys.includes('primary_lower') && gradeGroups['primary_lower'].includes(gradeKey)) return 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©';
                    if (selectedGradeKeys.includes('primary_upper') && gradeGroups['primary_upper'].includes(gradeKey)) return 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§';
                    if (selectedGradeKeys.includes('quran_lower') && gradeGroups['quran_lower'].includes(gradeKey)) return 'Ø£ÙˆÙ„ÙŠØ© ØªØ­ÙÙŠØ¸';
                    if (selectedGradeKeys.includes('quran_upper') && gradeGroups['quran_upper'].includes(gradeKey)) return 'Ø¹Ù„ÙŠØ§ ØªØ­ÙÙŠØ¸';

                    return gradeNames[gradeKey];
                };
                
                const fieldColors = {
                     'Ø§Ù„Ù…ÙˆØ§Ø·Ù†Ø© ÙˆØ§Ù„Ø­ÙŠØ§Ø©': '#981E47',
                     'Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ©': '#24344D',
                     'Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ÙˆØ§Ù„ØµØ­Ø©': '#2FB7BD',
                     'Ø§Ù„Ø«Ù‚Ø§ÙØ© ÙˆØ§Ù„ÙÙ†ÙˆÙ†': '#FF7145',
                     'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙƒØ´ÙÙŠ': '#018083',
                     'Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª': '#583C71',
                };

                const getProgramDetailsByWeek = (id, dates, teachersByGrade) => {
                    let programInfo;
                    let fieldTitle;
                    for (const field of activitiesData) {
                        const programIndex = field.programs.findIndex(p => `${field.id}-${field.programs.indexOf(p)}` === id);
                        if (programIndex !== -1) {
                            programInfo = field.programs[programIndex];
                            fieldTitle = field.title;
                            break;
                        }
                    }

                    if (!programInfo) return;

                    const processedGrades = new Set();
                    Object.entries(dates).forEach(([gradeKey, dateArray]) => {
                        if (processedGrades.has(gradeKey)) return;
                        
                        const individualGradesInGroup = gradeGroups[gradeKey] || [gradeKey];
                        const isGroupSelected = state.selectedGrades.includes(gradeKey);

                        if (!isGroupSelected) {
                            individualGradesInGroup.forEach(indKey => {
                                if (state.selectedGrades.includes(indKey) && dateArray.length > 0) {
                                    const gradeLabel = getGradeLabelForPrint(indKey);
                                    const sessionsCountForGrade = dateArray.length;
                                    const weekToDatesMap = {};
                                    dateArray.forEach(dateStr => {
                                        const weekInfo = getWeekInfoForDate(dateStr);
                                        if (weekInfo) {
                                            const weekKey = Object.keys(currentWeeksData).find(key => currentWeeksData[key].name === weekInfo.name);
                                            if (!weekToDatesMap[weekKey]) weekToDatesMap[weekKey] = [];
                                            weekToDatesMap[weekKey].push(dateStr);
                                        }
                                    });

                                    for (const weekKey in weekToDatesMap) {
                                         const sessionsCountForWeek = weekToDatesMap[weekKey].length;
                                         if (!programsByWeekAndField[weekKey]) programsByWeekAndField[weekKey] = {};
                                         if (!programsByWeekAndField[weekKey][fieldTitle]) programsByWeekAndField[weekKey][fieldTitle] = [];
                                         
                                         let teacherName = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                         if (teachersByGrade && teachersByGrade[indKey]) {
                                            teacherName = teachersByGrade[indKey];
                                         }

                                         let displayText = programInfo.name;
                                         if (gradeLabel) {
                                             displayText += `<br><span style="font-weight: normal;">(${gradeLabel} - ${sessionsCountForWeek} Ø­ØµØ©)</span>`;
                                         }
                                          if (teacherName !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') {
                                              displayText += `<br>Ø¨Ø¥Ø´Ø±Ø§Ù: ${teacherName}`;
                                          }

                                          if (!programsByWeekAndField[weekKey][fieldTitle].some(entry => entry.includes(displayText))) {
                                              programsByWeekAndField[weekKey][fieldTitle].push(displayText);
                                          }
                                    }
                                    processedGrades.add(indKey);
                                }
                            });
                        } else { // It's a group
                            if (dateArray.length > 0) {
                                 const gradeLabel = getLabel(gradeKey);
                                 const sessionsCountForGroup = programInfo.sessions[gradeKey]; // Corrected line
                                 const weekToDatesMap = {};
                                 dateArray.forEach(dateStr => {
                                     const weekInfo = getWeekInfoForDate(dateStr);
                                     if (weekInfo) {
                                         const weekKey = Object.keys(currentWeeksData).find(key => currentWeeksData[key].name === weekInfo.name);
                                         if (!weekToDatesMap[weekKey]) weekToDatesMap[weekKey] = [];
                                         weekToDatesMap[weekKey].push(dateStr);
                                     }
                                 });

                                 for (const weekKey in weekToDatesMap) {
                                     const sessionsCountForWeek = weekToDatesMap[weekKey].length;
                                     if (!programsByWeekAndField[weekKey]) programsByWeekAndField[weekKey] = {};
                                     if (!programsByWeekAndField[weekKey][fieldTitle]) programsByWeekAndField[weekKey][fieldTitle] = [];
                                     
                                     let teacherName = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                                     if (teachersByGrade && teachersByGrade[gradeKey]) {
                                        teacherName = teachersByGrade[gradeKey];
                                     }
                                     
                                     let displayText = programInfo.name;
                                      if (gradeLabel) {
                                         displayText += `<br><span style="font-weight: normal;">(${gradeLabel} - ${sessionsCountForWeek} Ø­ØµØ©)</span>`;
                                     }
                                     if (teacherName !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') {
                                         displayText += `<br>Ø¨Ø¥Ø´Ø±Ø§Ù: ${teacherName}`;
                                     }
                                     
                                     if (!programsByWeekAndField[weekKey][fieldTitle].some(entry => entry.includes(displayText))) {
                                         programsByWeekAndField[weekKey][fieldTitle].push(displayText);
                                     }
                                 }
                                 processedGrades.add(gradeKey);
                            }
                        }
                    });
                };

                Object.entries(programSelections).forEach(([id, data]) => {
                     getProgramDetailsByWeek(id, data.datesByGrade, data.teachersByGrade);
                });

// --- Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---
                let row1Weeks, row3Weeks, row5Weeks;

                if (state.currentRegion === 'western') {
                    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©: Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 12
                    row1Weeks = ['week1', 'week2', 'week3', 'week4', 'week5', 'week6', 'week7'];
                    row3Weeks = ['week8', 'week9', 'week10', 'week11', 'week12', 'autumn_break','week13'];
                    row5Weeks = [ 'week14', 'week15', 'week16', 'week17'];
                } else {
                    // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚): Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø®Ø±ÙŠÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 13
                    row1Weeks = ['week1', 'week2', 'week3', 'week4', 'week5', 'week6', 'week7'];
                    row3Weeks = ['week8', 'week9', 'week10', 'week11', 'week12', 'week13', 'autumn_break'];
                    row5Weeks = ['week14', 'week15', 'week16', 'week17', 'week18'];
                }
                // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---

                const getWeekContent = (weeks) => {
                    let weekHtml = '';
                    let programHtml = '';
                    
                    weeks.forEach((weekKey) => {
                         const weekData = currentWeeksData[weekKey];
                         if (!weekData) return; // Added null check here
                         let weekLabel = weekData.name;
                         let programsContent = '';
                        
                        const fieldNames = Object.keys(programsByWeekAndField[weekKey] || {});
                        
                        if (fieldNames.length > 0) {
                            fieldNames.forEach(fieldName => {
                                 programsContent += `<strong style="color: ${fieldColors[fieldName] || 'black'};">${fieldName}</strong><br>`;
                                 programsContent += `<div class="program-entries">`;
                                 programsContent += [...new Set(programsByWeekAndField[weekKey][fieldName] || [])].map(p => `<div class="program-entry">${p}</div>`).join('');
                                 programsContent += `</div>`;
                            });
                        }
                        
                        if (weekKey === 'exams') {
                             weekHtml += `<th class="week-header" colspan="2">${weekLabel}<br>(${weekData.startDate} - ${weekData.endDate})</th>`;
                             programHtml += `<td colspan="2">${programsContent}</td>`;
                        } else if (weekKey === 'autumn_break') {
                             weekHtml += `<th class="week-header">${weekLabel}<br>(${weekData.startDate} - ${weekData.endDate})</th>`;
                             programHtml += `<td>${programsContent}</td>`;
                        } else {
                             weekHtml += `<th class="week-header">${weekLabel}<br>(${weekData.startDate} - ${weekData.endDate})</th>`;
                             programHtml += `<td>${programsContent}</td>`;
                        }

                    });
                    return { weekHtml, programHtml };
                };
                
                const row1Data = getWeekContent(row1Weeks);
                const row3Data = getWeekContent(row3Weeks);
                const row5Data = getWeekContent(row5Weeks);


                const printTableContent = `
                    <table class="print-table" style="page-break-inside: auto;">
                        <thead>
                            <tr>
                                <td class="week-label" style="width: 8%;">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</td>
                                ${row1Data.weekHtml}
                            </tr>
                            <tr>
                                <td class="program-label" style="width: 8%;">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</td>
                                ${row1Data.programHtml}
                            </tr>
                            <tr>
                                <td class="week-label" style="width: 8%;">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</td>
                                ${row3Data.weekHtml}
                            </tr>
                            <tr>
                                <td class="program-label" style="width: 8%;">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</td>
                                ${row3Data.programHtml}
                            </tr>
                            <tr>
                                <td class="week-label" style="width: 8%;">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</td>
                                ${row5Data.weekHtml}
                                <th class="week-header" colspan="2">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª<br>(${currentWeeksData.exams.startDate} - ${currentWeeksData.exams.endDate})</th>
                            </tr>
                            <tr>
                                <td class="program-label" style="width: 8%;">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</td>
                                ${row5Data.programHtml}
                                <td colspan="2">${Object.keys(programsByWeekAndField.exams || {}).map(fieldName => `<strong style="color: ${fieldColors[fieldName] || 'black'}">${fieldName}</strong><br>${[...new Set(programsByWeekAndField.exams[fieldName] || [])].join('<br>')}</div>`).join('<br>')}</td>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                `;
                
                const schoolName = state.schoolName || 'Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©';
                const printFontSize = state.printFontSize || '8px';
                const printFontFamily = 'Readex Pro';
                const printStageTitle = document.getElementById('stage-title-header').textContent || 'Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©';
                const printSemesterSubtitle = document.getElementById('subtitle').textContent;
                const eduAdmin = state.educationAdmin || '';
                const eduRegion = state.educationRegion || '';
                const leaderName = state.activityLeaderName || 'Ø±Ø§Ø¦Ø¯/Ø© Ø§Ù„Ù†Ø´Ø§Ø·';
                const directorName = state.schoolDirectorName || 'Ù…Ø¯ÙŠØ±/Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©';
                
                // Generate the content for the second table based on selected programs only
                let secondTableRows = '';
                let programNumber = 1;

                // getProgramAndGradeLabels is a helper function to format the program name with grade and session count
                const getProgramAndGradeLabels = (program, sessionsByGrade) => {
                    const programLabels = [];
                    // This function should aggregate by group if a group is selected, otherwise list individuals.
                    const effectiveSelection = state.selectedGrades;
                    const handledGrades = new Set();
                    
                    effectiveSelection.forEach(key => {
                        let label;
                        let sessionsCount;
                        if (gradeGroups[key]) {
                            label = getLabel(key);
                            sessionsCount = Math.max(0, ...gradeGroups[key].map(g => program.sessions[g] || 0));
                            if (sessionsCount > 0) {
                                programLabels.push(`${label} ${sessionsCount} Ø­ØµØ©`);
                                gradeGroups[key].forEach(g => handledGrades.add(g));
                            }
                        } else if (!handledGrades.has(key)) {
                            label = getLabel(key);
                            sessionsCount = program.sessions[key] || 0;
                            if (sessionsCount > 0) {
                                programLabels.push(`${label} ${sessionsCount} Ø­ØµØ©`);
                                handledGrades.add(key);
                            }
                        }
                    });

                    const programName = program.name;
                    return `${programName} (${programLabels.join(' Ùˆ ')})`;
                };
                
                // Get all selected programs and sort them based on their original order
                const selectedPrograms = [];
                activitiesData.forEach(field => {
                    field.programs.forEach((program, programIndex) => {
                        const programId = `${field.id}-${programIndex}`;
                        if (programSelections[programId]) {
                            selectedPrograms.push({
                                field,
                                program,
                                programId,
                                selectionData: programSelections[programId]
                            });
                        }
                    });
                });

                selectedPrograms.forEach(item => {
                    const { field, program, programId, selectionData } = item;
                    const datesByGrade = selectionData?.datesByGrade || {};
                    const teachersByGrade = selectionData?.teachersByGrade || {};
                    const notes = selectionData?.notes || '';
                    
                    const programAndGradeText = getProgramAndGradeLabels(program, program.sessions);
                    
                    const allDates = Object.values(datesByGrade).flat();
                    const formattedDates = allDates.length > 0 ? formatDatesForDisplay(allDates).text : '';
                    
                    secondTableRows += `
                        <tr class="text-center">
                            <td style="padding: 4px; border: 1px solid #ccc; width: 3%;">${programNumber++}</td>
                            <td style="padding: 4px; border: 1px solid #ccc; background-color: ${field.color}; color: white; font-weight: bold; text-align: center; width: 10%;">${field.title}</td>
                            <td style="padding: 4px; border: 1px solid #ccc; text-align: right; width: 25%;">
                                ${program.name}<br>
                                <span style="font-size: 0.8em; color: #666; font-weight: normal; line-height: 1.5; ">${programAndGradeText.replace(program.name, '')}</span>
                            </td>
                            <td style="padding: 4px; border: 1px solid #ccc; text-align: right; width: 30%;">${formattedDates}</td>
                            <td style="padding: 4px; border: 1px solid #ccc; width: 10%;">
                               <div style="display:flex; justify-content:space-around; align-items:center; gap: 2px;">
                                    <label style="display:flex; align-items:center; gap:2px;"><input type="checkbox" style="width:10px; height:10px;"> Ù†ÙØ°</label>
                                    <label style="display:flex; align-items:center; gap:2px;"><input type="checkbox" style="width:10px; height:10px;"> Ù„Ù… ÙŠÙ†ÙØ°</label>
                               </div>
                            </td>
                            <td style="padding: 4px; border: 1px solid #ccc; width: 14%;">${notes}</td>
                        </tr>
                    `;
                });

                const printWindow = window.open('', '_blank', 'width=1200,height=800');
                if (!printWindow) {
                    alert('ÙØ´Ù„ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
                    isPrinting = false;
                    return;
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="ar" dir="rtl">
                    <head>
                        <meta charset="UTF-8">
                        <title>Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ Ù„Ù€ ${schoolName}</title>
                        <style>
                            @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
                            @import url('https://fonts.googleapis.com/css2?family=Readex+Pro:wght@400;700&display=swap');
                            @font-face {
                                font-family: 'Mohammad Bold Art 1';
                                src: url('https://d.top4top.io/p_2901k1t2b0.ttf') format('truetype');
                                font-weight: normal;
                                font-style: normal;
                            }
                            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
                            @page { size: A4 landscape; margin: 0; }
                            html, body { margin: 0; padding: 0; }
                            body { font-family: 'Readex Pro', sans-serif; font-size: ${printFontSize}; }
                            .print-page { 
                                display: flex;
                                flex-direction: column;
                                min-height: 100vh;
                                position: relative;
                            }
                            .print-page + .print-page {
                                 page-break-before: always;
                            }
                            .print-header-line {
                               height: 30px;
                               background: linear-gradient(135deg, #00A383 0%, #0093B5 100%);
                               width: 100%;
                               flex-shrink: 0;
                            }
                            .print-footer-line {
                               height: 30px;
                               background: linear-gradient(135deg, #00A383 0%, #0093B5 100%);
                               width: 100%;
                               flex-shrink: 0;
                            }
                            .print-header { 
                                display: flex; 
                                justify-content: space-between; 
                                align-items: center; 
                                margin: 8px 10mm; 
                                flex-shrink: 0; 
                                padding-top: 5mm;
                                margin-top: 0; 
                            }
                            .print-header .right-side { display: flex; align-items: center; gap: 8px; }
                            .print-header img { height: 40px; }
                            .print-header .header-text p { margin: 0; font-size: 0.9em; line-height: 1.2; }
                            .print-header .title-container { text-align: center; flex-grow: 1; }
                            .print-header h1 { color: #00A383; margin: 0; font-size: 1.8em; display: inline; }
                            .print-header h2 { font-size: 1.6em; font-weight: bold; color: #0093B5; margin: 1px 0; display: inline; margin-right: 5px; }
                            .print-header p.subtitle { color: #555; margin-top: 2px; font-size: 1.1em; }
                            .print-table {
                                width: calc(100% - 20mm);
                                margin: 0 10mm;
                                border-collapse: collapse;
                                table-layout: fixed;
                                font-size: 0.9em;
                                margin-top: 8px;
                                page-break-inside: auto !important; /* Allow tables to break across pages */
                            }
                            .print-table th, .print-table td {
                                border: 1px solid #ccc;
                                padding: 4px;
                                text-align: center;
                                vertical-align: top;
                                word-wrap: break-word;
                            }
                            .print-table th {
                                background-color: #f2f2f2;
                                font-weight: bold;
                            }
                            .print-table td.week-label {
                                background-color: #e6f7ff;
                                font-weight: bold;
                                color: #005f99;
                                text-align: center;
                                width: 8%; /* Specific width for this column */
                            }
                            .print-table td.program-label {
                                background-color: #f0f0f0;
                                font-weight: bold;
                                text-align: center;
                                width: 8%; /* Specific width for this column */
                            }
                             .print-table .week-header {
                                background-color: #e6f7ff;
                                font-weight: bold;
                                color: #005f99;
                                text-align: center;
                                width: 13.14%; /* Calculated width for other columns */
                             }
                            .print-signatures { 
                                display: flex; 
                                justify-content: space-around; 
                                margin: 15px 10mm; 
                                font-size: 1.1em; 
                                font-weight: bold; 
                                flex-shrink: 0; 
                                page-break-inside: avoid;
                            }
                            .signature-box { text-align: center; }
                            .checkbox-cell {
                                padding: 2px 4px;
                            }
                            .checkbox-label {
                                display: flex;
                                align-items: center;
                                gap: 4px;
                                cursor: pointer;
                            }
                            .checkbox-box {
                                width: 12px;
                                height: 12px;
                                border: 1px solid #000;
                                background-color: #fff;
                                display: inline-block;
                            }
                            .program-entry {
                                line-height: 1.3;
                                margin-bottom: 8px; 
                            }
                            .program-entry span {
                                 font-weight: normal;
                                 font-size: 0.85em;
                                 display: block;
                            }
                            .print-second-table {
                                margin-top: 0;
                                padding-top: 0;
                            }
                            /* New CSS for removing space and title */
                            h2.remove-on-print {
                                display: none;
                            }
                            .second-table-container.remove-margin {
                                margin-top: 0;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="print-page">
                            <div class="print-header-line"></div>
                            <div class="print-page-content">
                                <div class="print-header">
                                    <div class="right-side">
                                        <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ²Ø§Ø±Ø©">
                                        <div class="header-text">
                                            <p>${eduAdmin}</p><p>${eduRegion}</p><p>${schoolName}</p>
                                        </div>
                                    </div>
                                    <div class="title-container">
                                        <h1 style="display: inline;">Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
                                        <h2 style="display: inline; margin-right: 5px;">${printStageTitle}</h2>
                                        <p class="subtitle">${printSemesterSubtitle}</p>
                                    </div>
                                    <div></div> 
                                </div>
                                ${printTableContent}
                            </div>
                            <div class="print-signatures">
                                <div class="signature-box"><p>${leaderName}</p></div>
                                <div class="signature-box"><p>${directorName}</p></div>
                            </div>
                        </div>
                        
                        ${secondTableRows.length > 0 ? `
                        <div class="print-page">
                            <div class="print-header-line"></div>
                            <div class="print-page-content">
                                <div class="print-header">
                                    <div class="right-side">
                                        <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ²Ø§Ø±Ø©">
                                        <div class="header-text">
                                            <p>${eduAdmin}</p><p>${eduRegion}</p><p>${schoolName}</p>
                                        </div>
                                    </div>
                                    <div class="title-container">
                                        <h1 style="display: inline;">Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
                                        <h2 style="display: inline; margin-right: 5px;">${printStageTitle}</h2>
                                        <p class="subtitle">${printSemesterSubtitle}</p>
                                    </div>
                                    <div></div> 
                                </div>
                                <div class="second-table-container remove-margin">
                                    <h2 class="remove-on-print" style="font-size: 1.5em; font-weight: bold; text-align: center; margin-bottom: 10px;">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</h2>
                                    <table class="print-table print-second-table" style="page-break-inside: auto; margin-top: 0;">
                                        <thead>
                                            <tr class="bg-gray-100 text-gray-700">
                                                <th style="padding: 4px; border: 1px solid #ccc; width: 3%;">Ù…</th>
                                                <th style="padding: 4px; border: 1px solid #ccc; width: 10%;">Ø§Ù„Ù…Ø¬Ø§Ù„</th>
                                                <th style="padding: 4px; border: 1px solid #ccc; text-align: right; width: 25%;">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆØ¹Ø¯Ø¯ Ø­ØµØµÙ‡ Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©</th>
                                                <th style="padding: 4px; border: 1px solid #ccc; text-align: right; width: 30%;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù† - Ø¥Ù„Ù‰</th>
                                                <th style="padding: 4px; border: 1px solid #ccc; width: 10%;">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°</th>
                                                <th style="padding: 4px; border: 1px solid #ccc; width: 14%;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${secondTableRows}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="print-signatures">
                                <div class="signature-box"><p>${leaderName}</p></div>
                                <div class="signature-box"><p>${directorName}</p></div>
                            </div>
                        </div>
                        ` : ''}
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                printWindow.focus();
                
                printWindow.onload = () => {
                    printWindow.print();
                    isPrinting = false;
                    printWindow.close();
                };

                printWindow.onafterprint = () => {
                    isPrinting = false;
                };
            } catch (error) {
                console.error("Printing error:", error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                isPrinting = false;
            }
        }
        
        function saveBackup() {
            saveState();
            const stateToSave = localStorage.getItem('activityPlanState');
            if (!stateToSave || stateToSave === "{}") {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø­ÙØ¸Ù‡Ø§.');
                return;
            }
            const blob = new Blob([stateToSave], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const schoolName = JSON.parse(stateToSave).schoolName || 'Ø®Ø·Ø©-Ø§Ù„Ù†Ø´Ø§Ø·';
            a.href = url;
            a.download = `backup-${schoolName}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„Ù.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedState = e.target.result;
                    const parsedState = JSON.parse(loadedState);
                    if (parsedState && typeof parsedState === 'object' && 'programSelections' in parsedState) {
                        localStorage.setItem('activityPlanState', loadedState);
                        alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.');
                        location.reload();
                    } else {
                        throw new Error('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØªØ§Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ­ÙŠØ­ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.');
                    }
                } catch (error) {
                    alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØªØ§Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ­ÙŠØ­ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
        
        function changeFontFamily(fontFamily) {
             document.documentElement.style.setProperty('--main-font', `"${fontFamily}", sans-serif`);
             saveState();
        }
        
        function saveState() {
            if (isLoading) return;

            const programSelections = {};
            document.querySelectorAll('main tr[data-program-id]').forEach(row => {
                const id = row.dataset.programId;
                const datesByGrade = {};
                const teachersByGrade = {};
                let hasData = false;

                row.querySelectorAll('.teacher-input').forEach(input => {
                    const key = input.dataset.gradeKey;
                    if (input.value.trim() !== '') {
                        teachersByGrade[key] = input.value.trim();
                        hasData = true;
                    }
                });

                row.querySelectorAll('.grade-date-selector').forEach(selector => {
                    const key = selector.dataset.gradeKey;
                    const displayDiv = selector.querySelector('.dates-display');
                    const datesJson = displayDiv.dataset.dates;
                    
                    if (datesJson) {
                        const dates = JSON.parse(datesJson);
                        if (dates.length > 0) {
                            const groupOrGradeKey = selector.dataset.gradeKey;
                            
                            if(gradeGroups[groupOrGradeKey]) {
                                datesByGrade[groupOrGradeKey] = dates;
                            } else {
                                datesByGrade[groupOrGradeKey] = dates;
                            }
                            
                            const individualKeys = gradeGroups[key] || [key];
                             individualKeys.forEach(indKey => {
                                datesByGrade[indKey] = dates;
                            });
                            hasData = true;
                        }
                    }
                });

                if (hasData) {
                   programSelections[id] = { teachersByGrade, datesByGrade };
                }
            });

            const state = {
                educationAdmin: document.getElementById('education-admin').value,
                educationRegion: document.getElementById('education-region').value,
                schoolName: document.getElementById('school-name').value,
                activityLeaderName: document.getElementById('activity-leader-name').value,
                schoolDirectorName: document.getElementById('school-director-name').value,
                currentRegion: currentRegion,
                selectedGrades: selectedGrades,
                programSelections: programSelections,
                printFontSize: document.getElementById('print-font-size').value,
            };
            localStorage.setItem('activityPlanState', JSON.stringify(state));
        }

        function loadState() {
            isLoading = true;
            const savedState = localStorage.getItem('activityPlanState');
            if (!savedState) {
                isLoading = false;
                return;
            }
            
            const state = JSON.parse(savedState);
            
            document.getElementById('education-admin').value = state.educationAdmin || '';
            document.getElementById('education-region').value = state.educationRegion || '';
            document.getElementById('school-name').value = state.schoolName || '';
            document.getElementById('activity-leader-name').value = state.activityLeaderName || '';
            document.getElementById('school-director-name').value = state.schoolDirectorName || '';
            document.getElementById('print-font-size').value = state.printFontSize || '8px';
            
            selectRegion(state.currentRegion || 'other');
            
            selectedGrades = state.selectedGrades || [];
            
            updateButtonStyles();
            updateTitle();
            updateAllDateSelectors();

             if (state.programSelections) {
                Object.entries(state.programSelections).forEach(([id, data]) => {
                    const row = document.querySelector(`tr[data-program-id="${id}"]`);
                    if (row) {
                         if (data.teachersByGrade) {
                            Object.entries(data.teachersByGrade).forEach(([gradeKey, teacherName]) => {
                                const input = row.querySelector(`.teacher-input[data-grade-key="${gradeKey}"]`);
                                if (input) {
                                    input.value = teacherName;
                                }
                            });
                        }
                        
                        if (data.datesByGrade) {
                            row.querySelectorAll('.grade-date-selector').forEach(selector => {
                                const key = selector.dataset.gradeKey;
                                let datesToShow = data.datesByGrade[key] || data.datesByGrade[(gradeGroups[key] || [key])[0]] || [];
                               
                                const displayDiv = selector.querySelector('.dates-display');
                                const formatted = formatDatesForDisplay(datesToShow);
                                displayDiv.textContent = formatted.text;
                                displayDiv.dataset.dates = formatted.json;
                            });
                        }
                    }
                });
            }
            isLoading = false;
        }

        function resetPlan() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
                    <h3 class="text-xl font-bold mb-4">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø­</h3>
                    <p class="text-gray-600 mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="document.body.removeChild(this.closest('.fixed'));" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 font-semibold">Ø¥Ù„ØºØ§Ø¡</button>
                        <button onclick="localStorage.removeItem('activityPlanState'); location.reload();" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold">Ù†Ø¹Ù…ØŒ Ù…Ø³Ø­</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showUpdateModal() {
            const modal = document.getElementById('update-modal');
            const modalBox = document.getElementById('update-modal-box');
            modal.style.display = 'flex';
            setTimeout(() => {
                modalBox.classList.add('active');
            }, 50); 
        }

        function closeUpdateModal() {
            const modal = document.getElementById('update-modal');
            const modalBox = document.getElementById('update-modal-box');
            modalBox.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            localStorage.setItem(UPDATE_VERSION_KEY, 'true');
        }

        document.addEventListener('DOMContentLoaded', function() {
            createGradeSelectionUI();
            generateSections();
            loadState();
            if (!localStorage.getItem(UPDATE_VERSION_KEY)) {
                showUpdateModal();
            }
        });
    </script>
</body>
</html>
